generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                   String        @id @default(cuid())
  username             String        @unique
  email                String        @unique
  password             String
  firstName            String
  middleName           String?
  lastName             String
  profile              String?
  role                 UserRole      @default(PATIENT)
  isActive             Boolean       @default(true)
  isCurrentlyOnline    Boolean       @default(false)
  lastSeen             DateTime?
  resetPasswordToken   String?
  resetPasswordExpires DateTime?
  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt
  adminProfile         AdminProfile?
  receivedMessages     ChatMessage[] @relation("MessageReceiver")
  sentMessages         ChatMessage[] @relation("MessageSender")
  doctor               Doctor?
  patient              Patient?
  testimonials         Testimonial[]

  @@map("users")
}

model AdminProfile {
  id         String @id @default(cuid())
  userId     String @unique
  employeeId String @unique
  user       User   @relation(fields: [userId], references: [id])

  @@map("admin_profiles")
}

model Doctor {
  id              String          @id @default(cuid())
  userId          String          @unique
  licenseNumber   String          @unique
  specialization  String
  experience      Int
  qualifications  String[]
  consultationFee Decimal
  isAvailable     Boolean         @default(true)
  appointments    Appointment[]
  user            User            @relation(fields: [userId], references: [id])
  medicalRecords  MedicalRecord[]
  prescriptions   Prescription[]

  @@map("doctors")
}

model Patient {
  id               String          @id @default(cuid())
  userId           String          @unique
  patientId        String          @unique
  dateOfBirth      DateTime?
  gender           Gender?
  bloodGroup       String?
  contactNumber    String?
  emergencyContact String?
  address          String?
  admissions       Admission[]
  appointments     Appointment[]
  bills            Bill[]
  medicalRecords   MedicalRecord[]
  user             User            @relation(fields: [userId], references: [id])
  prescriptions    Prescription[]

  @@map("patients")
}

model Bed {
  id          String      @id @default(cuid())
  bedNumber   String      @unique
  bedType     BedType
  ward        String
  isOccupied  Boolean     @default(false)
  pricePerDay Decimal
  createdAt   DateTime    @default(now())
  admissions  Admission[]

  @@map("beds")
}

model Appointment {
  id        String            @id @default(cuid())
  patientId String
  doctorId  String
  dateTime  DateTime
  duration  Int               @default(30)
  reason    String
  status    AppointmentStatus @default(PENDING)
  notes     String?
  createdAt DateTime          @default(now())
  doctor    Doctor            @relation(fields: [doctorId], references: [id])
  patient   Patient           @relation(fields: [patientId], references: [id])

  @@map("appointments")
}

model Admission {
  id            String          @id @default(cuid())
  patientId     String
  bedId         String
  admissionDate DateTime        @default(now())
  dischargeDate DateTime?
  reason        String
  status        AdmissionStatus @default(ADMITTED)
  totalAmount   Decimal?
  createdAt     DateTime        @default(now())
  bed           Bed             @relation(fields: [bedId], references: [id])
  patient       Patient         @relation(fields: [patientId], references: [id])
  bills         Bill[]

  @@map("admissions")
}

model MedicalRecord {
  id          String   @id @default(cuid())
  patientId   String
  doctorId    String
  symptoms    String
  diagnosis   String
  treatment   String?
  notes       String?
  attachments String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  doctor      Doctor   @relation(fields: [doctorId], references: [id], onDelete: Cascade)
  patient     Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)

  @@map("medical_records")
}

model Prescription {
  id           String     @id @default(cuid())
  patientId    String
  doctorId     String
  instructions String
  issuedDate   DateTime   @default(now())
  validUntil   DateTime
  createdAt    DateTime   @default(now())
  medicines    Medicine[]
  doctor       Doctor     @relation(fields: [doctorId], references: [id])
  patient      Patient    @relation(fields: [patientId], references: [id])

  @@map("prescriptions")
}

model Medicine {
  id             String       @id @default(cuid())
  prescriptionId String
  name           String
  dosage         String
  frequency      String
  duration       String
  quantity       Int
  notes          String?
  createdAt      DateTime     @default(now())
  prescription   Prescription @relation(fields: [prescriptionId], references: [id])

  @@map("medicines")
}

model Bill {
  id          String     @id @default(cuid())
  patientId   String
  admissionId String?
  billNumber  String     @unique
  totalAmount Float
  dueDate     DateTime
  status      String     @default("PENDING")
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  billItems   BillItem[]
  admission   Admission? @relation(fields: [admissionId], references: [id])
  patient     Patient    @relation(fields: [patientId], references: [id])
  payments    Payment[]

  @@map("bills")
}

model BillItem {
  id          String @id @default(cuid())
  billId      String
  description String
  quantity    Int
  unitPrice   Float
  totalPrice  Float
  bill        Bill   @relation(fields: [billId], references: [id], onDelete: Cascade)

  @@map("bill_items")
}

model Payment {
  id                String        @id @default(cuid())
  billId            String
  amount            Decimal
  paymentMethod     PaymentMethod
  paymentDate       DateTime      @default(now())
  notes             String?
  receivedBy        String?
  receiptNo         String?
  bankName          String?
  transactionId     String?
  cardLast4         String?
  authorizationCode String?
  createdAt         DateTime      @default(now())
  bill              Bill          @relation(fields: [billId], references: [id])

  @@map("payments")
}

model ChatMessage {
  id         String   @id @default(cuid())
  content    String
  senderId   String
  receiverId String
  isRead     Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  receiver   User     @relation("MessageReceiver", fields: [receiverId], references: [id], onDelete: Cascade)
  sender     User     @relation("MessageSender", fields: [senderId], references: [id], onDelete: Cascade)

  @@map("chat_messages")
}

model Testimonial {
  id         String   @id @default(cuid())
  userId     String
  content    String
  rating     Int      @default(5)
  isApproved Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("testimonials")
}

enum UserRole {
  ADMIN
  DOCTOR
  PATIENT
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum BedType {
  GENERAL
  ICU
  EMERGENCY
  VIP
  MATERNITY
}

enum EquipmentStatus {
  WORKING
  MAINTENANCE
  OUT_OF_ORDER
  RETIRED
}

enum AppointmentStatus {
  SCHEDULED
  COMPLETED
  CANCELLED
  NO_SHOW
  PENDING
  REJECTED
}

enum AdmissionStatus {
  ADMITTED
  DISCHARGED
  TRANSFERRED
}

enum BillStatus {
  PENDING
  PARTIAL
  PAID
  OVERDUE
}

enum PaymentMethod {
  CASH
  BANK
}
